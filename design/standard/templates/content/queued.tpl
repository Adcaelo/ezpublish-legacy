{* DO NOT EDIT THIS FILE! Use an override template instead. *}

{ezscript_require( array( 'ezjsc::yui3', 'ezjsc::yui3io' ) )}

<script type="text/javascript">
<!--
var contentObjectId = {$contentObjectId};
var version = {$version};
var ajaxUri = 'ezpublishingqueue::status::' + contentObjectId + '::' + version;
var publishQueueUpdater = false;

{literal}
YUI( YUI3_config ).use('node', 'io-ez', function( Y )
{
    Y.on( "contentready", function( e )
    {
        publishingQueueUpdateStatus();
        publishQueueUpdater = Y.later( 1000, null, publishingQueueUpdateStatus, null, true );
    }, '#publish-queue-status' );

    function publishingQueueUpdateStatus()
    {
        Y.io.ez( ajaxUri, {
            on: {success: function( id,r )
                {
                    if ( r.responseJSON.error_text )
                        Y.get( '#publish-queue-status-placeholder' ).setContent( r.responseJSON.error_text );
                    else
                    {
                        status = r.responseJSON.content.status;

                        Y.get( '#publish-queue-status-placeholder' ).setContent( status );

                        if ( ( status == 'finished' ) && ( publishQueueUpdater != null ) )
                        {
                            node_uri = r.responseJSON.content.node_uri;
                            publishQueueUpdater.cancel();
                            Y.get( '#publish-queue-status-placeholder' ).setContent(
                                '<a href="' + node_uri + '">Completed. View published node</a>'
                            );
                        }
                    }
                }
            }
        });
    }
});
{/literal}
// -->
</script>
<h1>Your content is being published</h1>

<div id="publish-queue-wait-text">Please wait while your content is being published</div>

<div id="publish-queue-status">Status: <div id="publish-queue-status-placeholder" style="display: inline"></div></div>
